generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

<<<<<<< HEAD
model users {
  id                          String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  username                    String                 @unique @db.VarChar
  email                       String                 @unique @db.VarChar
  created_at                  DateTime?              @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  updated_at                  DateTime?              @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  availability                String?                @default("available") @db.VarChar
  profile_complete_percentage Int?                   @default(0)
  avatar_url                  String?
  location                    String?
  bio                         String?
  website_url                 String?
  github_url                  String?
  linkedin_url                String?
  twitter_url                 String?
  whatsapp_url                String?
  comments                    comments[]
  conversationMemberships     conversation_members[]
  eventsCreated               events[]               @relation("createdBy")
  receivedFriendRequests      friend_requests[]      @relation("receiver")
  sentFriendRequests          friend_requests[]      @relation("sender")
  friendOf                    friends[]              @relation("friendOf")
  friends                     friends[]              @relation("userFriends")
  likes                       likes[]
  messages                    messages[]             @relation("senderMessages")
  notifications               notifications[]
  opportunities               opportunities[]
  posts                       posts[]
  projectMemberships          project_members[]
  projects                    projects[]             @relation("owner")
  reels                       reels[]
  categories                  user_categories[]
  roles                       user_roles[]
  skills                      user_skills[]
=======
model User {
  id             String     @id @default(cuid())
  username       String     @unique
  email          String     @unique
  phone          String?
  passwordHash   String
  avatar         String?
  bio            String?
  role           UserRole   @default(DEVELOPER)
  postKarma      Int        @default(0)
  commentKarma   Int        @default(0)
  tokens         Int        @default(0)
  isVerified     Boolean    @default(false)
  verificationBadge String?
  portfolioUrl   String?
  skills         String[]
  experience     String?
  location       String?

  // Two-factor authentication
  twoFactorEnabled Boolean   @default(false)
  twoFactorSecret  String?
  backupCodes      String[]

  // Security
  lastLoginAt      DateTime?
  loginAttempts    Int        @default(0)
  lockedUntil      DateTime?

  // Relations
  posts          Post[]
  comments       Comment[]
  replies        Reply[]
  clientProjects Project[]    @relation("ProjectClient")
  assignedProjects Project[]  @relation("ProjectAssignee")
  bids           Bid[]
  messages       Message[]
  chatRooms      ChatRoomMember[]
  followers      Follow[]     @relation("UserFollowers")
  following      Follow[]     @relation("UserFollowing")
  likes          Like[]
  notifications  Notification[]
  reports        Report[]     @relation("Reporter")
  reportedBy     Report[]     @relation("ReportedUser")

  // New relations
  socialIntegrations SocialIntegration[]
  paymentsFrom       Payment[]          @relation("PaymentFrom")
  paymentsTo         Payment[]          @relation("PaymentTo")
  wallet             Wallet?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
>>>>>>> 86df2493645e4ef09bcef74454f135f41f3fd6df

  @@map("users")
}

<<<<<<< HEAD
model user_roles {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String?   @db.Uuid
  role_name  String    @db.VarChar
  created_at DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  user       users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("user_roles")
}

model user_categories {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id       String?   @db.Uuid
  category_name String    @db.VarChar
  created_at    DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  user          users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("user_categories")
}

model user_skills {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id           String?   @db.Uuid
  skill_name        String    @db.VarChar
  proficiency_level String?   @default("beginner") @db.VarChar
  availability      String?   @default("available") @db.VarChar
  created_at        DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  user              users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("user_skills")
}

model friend_requests {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sender_id   String?   @db.Uuid
  receiver_id String?   @db.Uuid
  message     String?
  status      String?   @default("pending")
  created_at  DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  receiver    users?    @relation("receiver", fields: [receiver_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sender      users?    @relation("sender", fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("friend_requests")
}

model friends {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String?   @db.Uuid
  friend_id    String?   @db.Uuid
  connected_at DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  friend       users?    @relation("friendOf", fields: [friend_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user         users?    @relation("userFriends", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("friends")
}

model conversations {
  id         String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type       String
  name       String?
  created_at DateTime?              @default(now()) @db.Timestamptz(6)
  members    conversation_members[]
  messages   messages[]

  @@map("conversations")
}

model conversation_members {
  conversation_id String        @db.Uuid
  user_id         String        @db.Uuid
  joined_at       DateTime?     @default(now()) @db.Timestamptz(6)
  conversation    conversations @relation(fields: [conversation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user            users         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([conversation_id, user_id])
  @@map("conversation_members")
}

model messages {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conversation_id String?        @db.Uuid
  sender_id       String?        @db.Uuid
  content         String
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  conversation    conversations? @relation(fields: [conversation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sender          users?         @relation("senderMessages", fields: [sender_id], references: [id], onUpdate: NoAction)

  @@map("messages")
}

model tags {
  id        String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name      String      @unique @db.VarChar
  post_tags post_tags[]

  @@map("tags")
}

model posts {
  id             String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  author_id      String?      @db.Uuid
  post_type      String
  title          String?
  content        String?
  created_at     DateTime?    @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  updated_at     DateTime?    @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  visibility     String?      @default("public")
  likes_count    Int?         @default(0)
  comments_count Int?         @default(0)
  comments       comments[]
  likes          likes[]
  media          post_media[]
  tags           post_tags[]
  author         users?       @relation(fields: [author_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
=======
model Post {
  id         String    @id @default(cuid())
  title      String
  content    String?
  postType   PostType  @default(TEXT)
  tags       String[]
  isVerified Boolean   @default(false)
  verifiedBy String?
  verifiedAt DateTime?

  // Relations
  author     User      @relation(fields: [authorId], references: [id])
  authorId   String
  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId String?
  comments   Comment[]
  likes      Like[]
  reports    Report[]  @relation("PostReports")

  // Social features
  likesCount    Int @default(0)
  commentsCount Int @default(0)
  sharesCount   Int @default(0)
  viewsCount    Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
>>>>>>> 86df2493645e4ef09bcef74454f135f41f3fd6df

  @@map("posts")
}

<<<<<<< HEAD
model post_media {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  post_id    String?   @db.Uuid
  media_type String?
  media_url  String?
  created_at DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  post       posts?    @relation(fields: [post_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("post_media")
}

model post_tags {
  post_id String @db.Uuid
  tag_id  String @db.Uuid
  post    posts  @relation(fields: [post_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tag     tags   @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([post_id, tag_id])
  @@map("post_tags")
}

model comments {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  post_id    String?   @db.Uuid
  author_id  String?   @db.Uuid
  content    String
  created_at DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  author     users?    @relation(fields: [author_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  post       posts?    @relation(fields: [post_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("comments")
}

model likes {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String?   @db.Uuid
  post_id    String?   @db.Uuid
  created_at DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  post       posts?    @relation(fields: [post_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("likes")
}

model projects {
  id          String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  owner_id    String?           @db.Uuid
  title       String
  description String?
  repo_url    String?
  status      String?           @default("active")
  created_at  DateTime?         @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  members     project_members[]
  owner       users?            @relation("owner", fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
=======
model Project {
  id           String        @id @default(cuid())
  title        String
  description  String
  projectType  ProjectType
  technologies String[]
  githubUrl    String?
  liveUrl      String?
  images       String[]
  budget       Float?
  status       ProjectStatus @default(OPEN)
  deadline     DateTime?

  // Relations
  client           User       @relation("ProjectClient", fields: [clientId], references: [id])
  clientId         String
  assignedTo       User?      @relation("ProjectAssignee", fields: [assignedToId], references: [id])
  assignedToId     String?
  payments         Payment[]
  bids         Bid[]
  category     Category @relation(fields: [categoryId], references: [id])
  categoryId   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
>>>>>>> 86df2493645e4ef09bcef74454f135f41f3fd6df

  @@map("projects")
}

<<<<<<< HEAD
model project_members {
  project_id String    @db.Uuid
  user_id    String    @db.Uuid
  role       String?
  joined_at  DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  project    projects  @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([project_id, user_id])
  @@map("project_members")
}

model opportunities {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  creator_id    String?   @db.Uuid
  title         String
  description   String?
  company_name  String?
  contact_email String?
  location      String?
  status        String?   @default("open")
  created_at    DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  creator       users?    @relation(fields: [creator_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("opportunities")
}

model reels {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id       String?   @db.Uuid
  title         String?
  video_url     String
  thumbnail_url String?
  views         Int?      @default(0)
  likes_count   Int?      @default(0)
  created_at    DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  user          users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("reels")
}

model notifications {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String?   @db.Uuid
  type       String?
  message    String?
  link       String?
  read       Boolean?  @default(false)
  created_at DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  user       users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
=======
model Category {
  id          String  @id @default(cuid())
  name        String  @unique
  description String?
  icon        String?
  color       String?

  // Relations
  posts    Post[]
  projects Project[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("categories")
}

model Comment {
  id       String  @id @default(cuid())
  content  String
  isEdited Boolean @default(false)

  // Relations
  post     Post    @relation(fields: [postId], references: [id])
  postId   String
  author   User    @relation(fields: [authorId], references: [id])
  authorId String
  replies  Reply[]
  likes    Like[]

  likesCount   Int @default(0)
  repliesCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("comments")
}

model Reply {
  id       String  @id @default(cuid())
  content  String
  isEdited Boolean @default(false)

  // Relations
  comment   Comment @relation(fields: [commentId], references: [id])
  commentId String
  author    User    @relation(fields: [authorId], references: [id])
  authorId  String
  likes     Like[]

  likesCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("replies")
}

model Bid {
  id       String    @id @default(cuid())
  amount   Float
  proposal String
  status   BidStatus @default(PENDING)

  // Relations
  project   Project @relation(fields: [projectId], references: [id])
  projectId String
  bidder    User    @relation(fields: [bidderId], references: [id])
  bidderId  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("bids")
}

model ChatRoom {
  id       String   @id @default(cuid())
  name     String?
  type     ChatType @default(DIRECT)
  isActive Boolean  @default(true)

  // Relations
  members  ChatRoomMember[]
  messages Message[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("chat_rooms")
}

model ChatRoomMember {
  id String @id @default(cuid())

  // Relations
  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id])
  chatRoomId String
  user       User     @relation(fields: [userId], references: [id])
  userId     String

  joinedAt DateTime @default(now())

  @@unique([chatRoomId, userId])
  @@map("chat_room_members")
}

model Message {
  id          String      @id @default(cuid())
  content     String
  messageType MessageType @default(TEXT)
  isEdited    Boolean     @default(false)

  // Relations
  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id])
  chatRoomId String
  sender     User     @relation(fields: [senderId], references: [id])
  senderId   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("messages")
}

model Follow {
  id String @id @default(cuid())

  // Relations
  follower    User   @relation("UserFollowers", fields: [followerId], references: [id])
  followerId  String
  following   User   @relation("UserFollowing", fields: [followingId], references: [id])
  followingId String

  createdAt DateTime @default(now())

  @@unique([followerId, followingId])
  @@map("follows")
}

model Like {
  id String @id @default(cuid())

  // Relations
  user   User   @relation(fields: [userId], references: [id])
  userId String

  // Polymorphic relations (one of these will be set)
  post      Post?    @relation(fields: [postId], references: [id])
  postId    String?
  comment   Comment? @relation(fields: [commentId], references: [id])
  commentId String?
  reply     Reply?   @relation(fields: [replyId], references: [id])
  replyId   String?

  createdAt DateTime @default(now())

  @@map("likes")
}

model Notification {
  id      String           @id @default(cuid())
  type    NotificationType
  title   String
  message String
  isRead  Boolean          @default(false)

  // Relations
  user   User   @relation(fields: [userId], references: [id])
  userId String

  // Optional relations for specific notifications
  postId    String?
  commentId String?
  projectId String?
  messageId String?

  createdAt DateTime @default(now())
>>>>>>> 86df2493645e4ef09bcef74454f135f41f3fd6df

  @@map("notifications")
}

<<<<<<< HEAD
model events {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  title       String
  description String?
  location    String?
  start_time  DateTime? @db.Timestamptz(6)
  end_time    DateTime? @db.Timestamptz(6)
  created_by  String?   @db.Uuid
  createdBy   users?    @relation("createdBy", fields: [created_by], references: [id], onUpdate: NoAction)

  @@map("events")
=======
model Report {
  id          String       @id @default(cuid())
  reason      String
  description String?
  status      ReportStatus @default(PENDING)

  // Relations
  reporter       User    @relation("Reporter", fields: [reporterId], references: [id])
  reporterId     String
  reportedUser   User?   @relation("ReportedUser", fields: [reportedUserId], references: [id])
  reportedUserId String?
  reportedPost   Post?   @relation("PostReports", fields: [reportedPostId], references: [id])
  reportedPostId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("reports")
}

// Enums
enum UserRole {
  DEVELOPER
  CLIENT
  ADMIN
}

enum PostType {
  TEXT
  IMAGE
  VIDEO
  LINK
  PROJECT
}

enum ProjectType {
  WEBSITE
  MOBILE_APP
  DESKTOP_APP
  API
  OTHER
}

enum ProjectStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BidStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum ChatType {
  DIRECT
  GROUP
  PROJECT
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  CODE
}

enum NotificationType {
  LIKE
  COMMENT
  FOLLOW
  PROJECT_BID
  PROJECT_ASSIGNED
  PROJECT_COMPLETED
  MESSAGE
  SYSTEM
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  DISMISSED
}

enum SocialPlatform {
  GITHUB
  LINKEDIN
  TWITTER
  DISCORD
  STACKOVERFLOW
  MEDIUM
}

enum PaymentMethod {
  STRIPE
  PAYPAL
  MPESA
  BANK_TRANSFER
  WALLET
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum Currency {
  USD
  EUR
  GBP
  KES
}

model SocialIntegration {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  platform      SocialPlatform
  accessToken   String?
  refreshToken  String?
  profileData   Json?
  isConnected   Boolean  @default(false)
  connectedAt   DateTime?
  lastSyncedAt  DateTime?

  @@unique([userId, platform])
  @@map("social_integrations")
}

model Payment {
  id              String        @id @default(cuid())
  amount          Float
  currency        Currency      @default(USD)
  method          PaymentMethod
  status          PaymentStatus @default(PENDING)
  transactionId   String?       @unique
  externalId      String?       // Stripe/PayPal/M-Pesa reference

  // Relations
  fromUserId      String
  fromUser        User          @relation("PaymentFrom", fields: [fromUserId], references: [id])
  toUserId        String?
  toUser          User?         @relation("PaymentTo", fields: [toUserId], references: [id])

  // Project related payments
  projectId       String?
  project         Project?      @relation(fields: [projectId], references: [id])

  // Wallet relation
  walletId        String?
  wallet          Wallet?       @relation(fields: [walletId], references: [id])

  // Metadata
  description     String?
  metadata        Json?
  processedAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("payments")
}

model Wallet {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id])
  balance     Float    @default(0)
  currency    Currency @default(USD)
  isActive    Boolean  @default(true)

  // Transaction history
  transactions Payment[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("wallets")
>>>>>>> 86df2493645e4ef09bcef74454f135f41f3fd6df
}
